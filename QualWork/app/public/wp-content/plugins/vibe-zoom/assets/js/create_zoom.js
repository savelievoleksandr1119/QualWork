(()=>{"use strict";const{createContext:e}=wp.element,t=e({}),{createElement:i,useState:a,useEffect:n,Fragment:s,render:o,useRef:r}=wp.element,{dispatch:l,select:d}=wp.data,m=e=>{const[t,o]=a("");return n((()=>{let t="",i="",a={};switch(e.type){case"friends":i="user",t=e.id.item_id;break;case"group":i="group",t=e.id.id,a={item_id:e.id.id};break;case"activity":i="user",t=e.id.secondary_item_id;break;case"user":i="user",t=e.id.user_id;break;case"shared":i="user",t=e.id.id,a={user_id:e.id.id};break;case"course":i="course",t=e.id.id,a={item_id:e.id.id};break;default:i=e.type,t=e.id.id}localforage.getItem(i+"_"+t).then((n=>{null!==n?o(JSON.parse(n)):fetch(`${window.vibebp.api.url}/avatar?type=${i}&ids=${JSON.stringify(a)}`,{method:"post",body:JSON.stringify({type:i,ids:a,token:d("vibebp").getToken()})}).then((e=>e.json())).then((a=>{if(a.name){let n={...a,id:e.id.id};localforage.setItem(i+"_"+t,JSON.stringify(n)),o(n)}}))}))}),[e.id]),i(s,null,e.not_show_name?i("img",{src:t.avatar,className:"vibebp_avatar",onClick:e.click,alt:t.name,title:t.name}):i("span",null,i("img",{src:t.avatar,className:"vibebp_avatar",onClick:e.click,alt:t.name,title:t.name}),i("span",null,t.name)))},c=(e,t,i=[])=>{const a=r(Date.now());n((()=>{const i=setTimeout((function(){Date.now()-a.current>=t&&(e(),a.current=Date.now())}),t-(Date.now()-a.current));return()=>{clearTimeout(i)}}),[t,...i])},{createElement:p,useState:_,useEffect:u,Fragment:v,render:b,useContext:g,useRef:h}=wp.element,{dispatch:w,select:y}=wp.data;let f={};const k=e=>{const[t,i]=_(!1),[a,n]=_({id:0,post_title:"",post_content:"",raw:"",meta:{host:"",start_date:"",duration:60,time_zone:"",password:window.vibezoom.settings.dafault_password,join_before_host:!1,host_video:!1,participant_video:!1,mute_upon_entry:!1,enforce_login:!1,auto_recording:!1,alternative_host_ids:[],multihostkey:"",show_recordings:!1},shared:{shared_type:Object.keys(window.vibezoom.shared_tabs)[0],shared_values:[]}}),[s,o]=_({}),[r,l]=_({}),[d,v]=_(""),[b,g]=_([]),[k,N]=_(!1),[z,C]=_(null),O=h(null);u((()=>{let t={...a,...e.meeting};t.meta={...a.meta,...e.meeting.meta},n(t),j(t.meta.multihostkey)}),[e.meeting]),c((()=>{if(g([]),d.length>2&&a.shared.shared_type){z&&z.abort();let e=new AbortController,t=z?{signal:e.signal}:{};C(e);let i={s:d,shared_type:a.shared.shared_type};fetch(`${window.vibezoom.api.url}/search?nocache`,{method:"post",...t,body:JSON.stringify({...i,token:y("vibebp").getToken()})}).then((e=>e.json())).then((e=>{e.status&&e.values&&Array.isArray(e.values)&&g(e.values)})).catch((e=>{"AbortError"!==e.name&&(C(null),console.error("Uh oh, an error!",e))}))}}),500,[d]),u((()=>{f=a}),[a]),u((()=>{let e=null;return O&&(e=setTimeout((()=>{flatpickr(O.current,{altInput:!0,defaultDate:a.meta.start_date,enableTime:!0,onChange:(e,t,i)=>{let a={...f};a.meta.start_date=t,n(a)}})}),200)),()=>{e&&clearTimeout(e)}}),[O]);const E=e=>!(e<1e5||e>99999999),j=e=>{N(!0),fetch(`${window.vibezoom.api.url}/user/get_new_meeting_pre?nocache`,{method:"post",body:JSON.stringify({token:y("vibebp").getToken(),key:e})}).then((e=>e.json())).then((e=>{N(!1),l(e)}))};return u((()=>{var t=new CustomEvent("load_vibe_editor",{detail:{selector:".vibe_zoom_editor",content:e.hasOwnProperty("meeting")&&e.meeting.post_content?e.meeting.post_content:"",raw:e.hasOwnProperty("meeting")&&e.meeting.raw?e.meeting.raw:"",components:"editor",updater:"vibe_zoom"}});document.dispatchEvent(t),document.addEventListener("vibe_editor_content_update_vibe_zoom",(e=>{o({post_content:e.detail.raw_html,raw:e.detail.editor_content})}))}),[]),p("div",{className:"new_zoom_meeting"},p("div",{className:"new_meeting_header"},p("span",{className:"vicon vicon-arrow-left",onClick:e.back})),p("div",{className:"new_meeting_content vibebp_form"},p("div",{className:"vibebp_form_field meeting_title"},p("label",null,window.vibezoom.translations.meeting_title),p("input",{type:"text",value:a.post_title,onChange:e=>{n({...a,post_title:e.target.value})}})),p("div",{className:"vibebp_form_field password"},p("label",null,window.vibezoom.translations.password),p("input",{className:E(a.meta.password)?"":"not_valid",type:"number",value:a.meta.password,onChange:e=>{let t={...a};t.meta.password=e.target.value,n(t)}})),p("div",{className:"vibebp_form_field meeting_content"},p("label",null,window.vibezoom.translations.meeting_content),p("div",{className:"vibe_zoom_editor"},p("textarea",{onChange:e=>{n({...a,post_content:e.target.value}),o({...s,post_content:e.target.value})},value:a.post_content}))),p("div",{className:"zoom_meeting_timings"},p("div",{className:"vibebp_form_field meeting_start_time"},p("label",null,window.vibezoom.translations.meeting_start_time),p("input",{type:"text",ref:O,value:a.meta.start_date})),p("div",{className:"vibebp_form_field meeting_start_time"},p("label",null,window.vibezoom.translations.meeting_duration_in_minutes),p("input",{type:"number",value:a.meta.duration,onChange:e=>{let t={...a};t.meta.duration=e.target.value,n(t)}})),r.hasOwnProperty("time_zones")&&r.time_zones?p("div",{className:"vibebp_form_field time_zone"},p("label",null,window.vibezoom.translations.time_zone),p("select",{value:a.meta.time_zone,onChange:e=>{let t={...a};t.meta.time_zone=e.target.value,n(t)}},p("option",{value:""},window.vibezoom.translations.select_time_zone),Object.keys(r.time_zones).map((e=>p("option",{value:e},r.time_zones[e]))))):""),p("div",{className:"zoom_meeting_controls"},p("div",{className:"vibebp_form_field join_before_host"},p("p",null,window.vibezoom.translations.join_before_host),p("div",{className:"switch"},a.meta.join_before_host?p("input",{type:"checkbox",id:"join_before_host",checked:!0,onClick:()=>{let e={...a};e.meta.join_before_host=!e.meta.join_before_host,n(e)}}):p("input",{type:"checkbox",id:"join_before_host",onClick:()=>{let e={...a};e.meta.join_before_host=!e.meta.join_before_host,n(e)}}),p("label",{for:"join_before_host",className:"slider"}))),p("div",{className:"vibebp_form_field host_video"},p("p",null,window.vibezoom.translations.host_video),p("div",{className:"switch"},a.meta.host_video?p("input",{type:"checkbox",id:"host_video",checked:!0,onClick:()=>{let e={...a};e.meta.host_video=!e.meta.host_video,n(e)}}):p("input",{type:"checkbox",id:"host_video",onClick:()=>{let e={...a};e.meta.host_video=!e.meta.host_video,n(e)}}),p("label",{for:"host_video",className:"slider"}))),p("div",{className:"vibebp_form_field participant_video"},p("p",null,window.vibezoom.translations.participant_video),p("div",{className:"switch"},a.meta.participant_video?p("input",{type:"checkbox",id:"participant_video",checked:!0,onClick:()=>{let e={...a};e.meta.participant_video=!e.meta.participant_video,n(e)}}):p("input",{type:"checkbox",id:"participant_video",onClick:()=>{let e={...a};e.meta.participant_video=!e.meta.participant_video,n(e)}}),p("label",{for:"participant_video",className:"slider"}))),p("div",{className:"vibebp_form_field mute_upon_entry"},p("p",null,window.vibezoom.translations.mute_upon_entry),p("div",{className:"switch"},a.meta.mute_upon_entry?p("input",{type:"checkbox",id:"mute_upon_entry",checked:!0,onClick:()=>{let e={...a};e.meta.mute_upon_entry=!e.meta.mute_upon_entry,n(e)}}):p("input",{type:"checkbox",id:"mute_upon_entry",onClick:()=>{let e={...a};e.meta.mute_upon_entry=!e.meta.mute_upon_entry,n(e)}}),p("label",{for:"mute_upon_entry",className:"slider"}))),p("div",{className:"vibebp_form_field enforce_login"},p("p",null,window.vibezoom.translations.enforce_login),p("div",{className:"switch"},a.meta.enforce_login?p("input",{type:"checkbox",id:"enforce_login",checked:!0,onClick:()=>{let e={...a};e.meta.enforce_login=!e.meta.enforce_login,n(e)}}):p("input",{type:"checkbox",id:"enforce_login",onClick:()=>{let e={...a};e.meta.enforce_login=!e.meta.enforce_login,n(e)}}),p("label",{for:"enforce_login",className:"slider"}))),p("div",{className:"vibebp_form_field auto_recording"},p("p",null,window.vibezoom.translations.auto_recording),p("div",{className:"switch"},a.meta.auto_recording?p("input",{type:"checkbox",id:"auto_recording",checked:!0,onClick:()=>{let e={...a};e.meta.auto_recording=!e.meta.auto_recording,n(e)}}):p("input",{type:"checkbox",id:"auto_recording",onClick:()=>{let e={...a};e.meta.auto_recording=!e.meta.auto_recording,n(e)}}),p("label",{for:"auto_recording",className:"slider"}))),p("div",{className:"vibebp_form_field show_recordings"},p("p",null,window.vibezoom.translations.show_recordings_to_user),p("div",{className:"switch"},a.meta.show_recordings?p("input",{type:"checkbox",id:"show_recordings",checked:!0,onClick:()=>{let e={...a};e.meta.show_recordings=!e.meta.show_recordings,n(e)}}):p("input",{type:"checkbox",id:"show_recordings",onClick:()=>{let e={...a};e.meta.show_recordings=!e.meta.show_recordings,n(e)}}),p("label",{for:"show_recordings",className:"slider"})))),p("div",{className:"zoom_meeting_sharing"},a.shared?p("div",{className:"shared"},p("div",{className:"vibebp_form_field select_sharing_type"},p("label",null,window.vibezoom.translations.select_sharing_type),p("select",{value:a.shared.shared_type,onChange:e=>{let t={...a};t.shared.shared_type=e.target.value,t.shared.shared_values=[],n(t)}},p("option",{value:""},window.vibezoom.translations.select_sharing_type),Object.keys(window.vibezoom.shared_types).map((e=>p("option",{value:e},window.vibezoom.shared_types[e]))))),a.shared.shared_type?p("div",null,a.shared.shared_values&&Array.isArray(a.shared.shared_values)?p("div",{className:"vibebp_form_field shared_with"},p("label",null,window.vibezoom.translations.shared_with),p("div",{className:"shared_values"},p("div",{className:"_all"},a.shared.shared_values.map(((e,t)=>p("div",{className:"vibebp_meeting_members",onClick:()=>{let e={...a};e.shared.shared_values.splice(t,1),n(e)}},p(m,{type:a.shared.shared_type,id:{id:parseInt(e)}}))))))):"",p("div",{className:"vibebp_form_field"},p("input",{type:"text",value:d,onChange:e=>{v(e.target.value)},placeholder:window.vibezoom.translations.search_text})),Array.isArray(b)&&b.length?p("div",{className:"vibebp_form_field"},p("div",{className:"vsearch_results"},p("div",{className:"_all"},b.map(((e,t)=>p("div",{className:"vibebp_meeting_members",onClick:()=>{let i={...a};if(-1==i.shared.shared_values.indexOf(e.id)){i.shared.shared_values.push(e.id);let a=[...b];a.splice(t,1),g(a)}n(i)}},p("span",null,e.label))))))):""):""):""),p("div",{className:"zoom_create_form_end"},r.hasOwnProperty("multihosts")&&r.multihosts&&!a.id?p("div",{className:"vibebp_form_field multihostkey"},p("label",null,window.vibezoom.translations.select_multihost_credential),p("select",{value:a.meta.multihostkey,onChange:e=>{let t={...a};t.meta.multihostkey=e.target.value,n(t),j(e.target.value)}},r.multihosts.map((e=>p("option",{value:e.key},e.title))))):"",r.hasOwnProperty("hosts")&&r.hosts&&!a.id?p("div",{className:"vibebp_form_field host"},p("label",null,window.vibezoom.translations.select_host),p("select",{value:a.meta.host,onChange:e=>{let t={...a};t.meta.host=e.target.value,n(t)}},p("option",{value:""},window.vibezoom.translations.select_host_user),Object.keys(r.hosts).map((e=>p("option",{value:e},r.hosts[e]))))):"",k?p("div",{class:"loading-roller"},p("div",null),p("div",null),p("div",null),p("div",null),p("div",null),p("div",null),p("div",null),p("div",null)):"",p("div",{className:"vibebp_form_field"},a.meta&&a.meta.host&&a.meta.password&&E(a.meta.password)?p("a",{className:t?"button is-primary is-loading":"button is-primary",onClick:()=>{i(!0);let t={...a,post_content:s.post_content,raw:s.raw},n=`?post&args=${encodeURIComponent(JSON.stringify({...a}))}`;fetch(`${window.vibezoom.api.url}/user/meetings/new${n}`,{method:"post",body:JSON.stringify({...t,token:y("vibebp").getToken()})}).then((e=>e.json())).then((t=>{i(!1),t.status&&e.created(t.meeting),t.hasOwnProperty("message")&&w("vibebp").addNotification({text:t.message})}))}},window.vibezoom.translations.submit):""))))},{useRef:N,useEffect:z,createElement:C}=wp.element;function O(e,t){return new Promise(((i,a)=>{let n="",s="";if("js"==t?(n="text/javascript",s="script"):"css"==t&&(n="text/css",s="style"),n||a("type not defined"),document.getElementById(e))i(!0);else{var o=document.createElement(s);o.setAttribute("id",e),o.setAttribute("type",n),o.setAttribute("src",e),void 0!==o&&(o.addEventListener&&o.addEventListener("load",(()=>{!function(e){console.log("loadFunc",e)}(e),i(!0)}),!1),document.getElementsByTagName("head")[0].appendChild(o))}}))}const{useState:E,useEffect:j,Fragment:x,useContext:S,createElement:I}=wp.element,{dispatch:P,select:A}=wp.data,J=e=>{const[t,i]=E(!1),[a,n]=E(!1),[s,o]=E(e.meeting),[r,l]=E(A("vibebp").getUser());j((()=>{o(e.meeting)}),[e.meeting]),j((()=>{}),[]);const d=e=>{if(s.meeting_details){n(e);let t=`?args=${encodeURIComponent(JSON.stringify({id:s.id}))}`;fetch(`${window.vibezoom.api.url}/user/meetings/record_join_activity${t}`,{method:"post",body:JSON.stringify({token:A("vibebp").getToken(),id:s.id})}).then((e=>e.json())).then((t=>{n(!1),t.hasOwnProperty("message")&&P("vibebp").addNotification({text:t.message}),t.status&&s.meeting_details&&(1==e?m(s.meeting_details):s.meeting_details.join_url&&window.open(s.meeting_details.join_url,"_blank"))}))}},m=e=>{["https://source.zoom.us/1.9.5/css/bootstrap.css","https://source.zoom.us/1.9.5/css/react-select.css"].map((e=>{O(e,"css")}));let t=[];["https://source.zoom.us/1.9.5/lib/vendor/react.min.js","https://source.zoom.us/1.9.5/lib/vendor/react-dom.min.js","https://source.zoom.us/1.9.5/lib/vendor/redux.min.js","https://source.zoom.us/1.9.5/lib/vendor/redux-thunk.min.js","https://source.zoom.us/1.9.5/lib/vendor/lodash.min.js","https://source.zoom.us/zoom-meeting-1.9.5.min.js"].map((e=>{t.push(O(e,"js"))})),Promise.all(t).then((t=>{ZoomMtg.setZoomJSLib("https://source.zoom.us/1.9.5/lib","/av"),ZoomMtg.preLoadWasm(),ZoomMtg.prepareJssdk(),ZoomMtg.init({leaveUrl:window.location.href,isSupportAV:!0,success:function(){let t="";if(window.vibezoom.settings.websdk_language)t=window.vibezoom.settings.websdk_language;else{let e=["de-DE","es-ES","en-US","fr-FR","jp-JP","pt-PT","ru-RU","zh-CN","zh-TW"],i=window.navigator.language,a=e.findIndex((e=>e.toLowerCase()==i.toLowerCase()));a>-1&&(t=e[a])}t&&(ZoomMtg.i18n.load(t),ZoomMtg.i18n.reload(t),ZoomMtg.reRender({lang:t})),ZoomMtg.join({signature:e.signature,apiKey:e.api_key,meetingNumber:e.meeting_id,userName:r.displayname,userEmail:r.email,passWord:e.password,error(e){console.log(e)},success:e=>{console.log(e);let t=document.getElementById("wpadminbar");t&&(t.style.display="none")}})}}),window.addEventListener("unload",(()=>{ZoomMtg.leaveMeeting({})}))}))};return I("div",{className:"join_vibezoom"},s.meeting_details?I(x,null,I(x,null,s.meeting_details.meeting_id?I(x,null,I("div",{className:"join_meeting_details"},e.hasOwnProperty("show_timing")?I("div",null,I("ul",{className:"bbb_meeting_details"},I("li",null,I("strong",null,window.vibezoom.translations.starts),I("span",null,new Date(s.meeting_details.start).toLocaleString())),I("li",null,I("strong",null,window.vibezoom.translations.ends),I("span",null,new Date(s.meeting_details.end).toLocaleString())))):""),s.meeting_details.password&&s.meeting_details.join_url?I("div",{className:"join_meeting_buttons"},t?I("div",{className:"vibe_zoom_iframe_container"},I("div",{class:"vibe_zoom_join_url"},I("span",null,window.vibezoom.translations.join_url),I("a",{href:"#",onClick:()=>{var e=document.createElement("textarea");e.innerText=s.meeting_details.join_url,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()}},s.meeting_details.join_url)),I("div",{class:"vibe_zoom_join_url"},I("span",null,window.vibezoom.translations.password),I("a",{href:"#",onClick:()=>{var e=document.createElement("textarea");e.innerText=s.meeting_details.passWord,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()}},s.meeting_details.password)),I("div",null,I("a",{className:1==a?"button is-primary open_in_same_tab is-loading":"button is-primary open_in_same_tab",onClick:()=>{d(1)}},window.vibezoom.translations.open_meeting),I("a",{className:2==a?"button is-primary open_in_new_tab is-loading":"button is-primary open_in_new_tab",onClick:()=>{d(2)}},window.vibezoom.translations.open_meeting_in_new_tab))):I("div",null,A("vibebp").getUser().id!=s.post_author?I("a",{className:"button is-primary",onClick:()=>{i(!t)}},window.vibezoom.translations.join_meeting):I("a",{className:"button is-primary",onClick:()=>{i(!t)}},window.vibezoom.translations.start_meeting))):""):"")):"")},{useState:$,useEffect:L,Fragment:T,createElement:D}=wp.element,{dispatch:R,select:M}=wp.data,U=e=>{const[t,i]=$(e.id),[a,n]=$([]),[s,o]=$(!1);return L((()=>{(()=>{o(!0);let e=`?nocache&args=${encodeURIComponent(JSON.stringify({id:t}))}`;fetch(`${window.vibezoom.api.url}/user/meetings/recordings${e}`,{method:"post",body:JSON.stringify({token:M("vibebp").getToken(),id:t})}).then((e=>e.json())).then((e=>{o(!1),e.status&&e.data.hasOwnProperty("recording_files")&&Array.isArray(e.data.recording_files)&&e.data.recording_files.length&&n(e.data.recording_files)}))})()}),[]),D("div",{className:"zoom_meeting_recordings"},Array.isArray(a)&&a.length?a.map((e=>D("div",{className:"meeting_recording"},D("div",{className:"meeting_recording_header"},D("span",null,window.vibezoom.translations.starts+" : "+new Date(e.recording_start).toLocaleString()),D("span",null,window.vibezoom.translations.ends+" : "+new Date(e.recording_end).toLocaleString())),D("div",{className:"meeting_recording_body"},D("a",{className:"link",href:e.play_url,target:"_blank"},window.vibezoom.translations.view_recording))))):D("div",{className:"vbp_message"},window.vibezoom.translations.no_recordings),s?D("div",{class:"loading-roller"},D("div",null),D("div",null),D("div",null),D("div",null),D("div",null),D("div",null),D("div",null),D("div",null)):"")},{useState:F,useEffect:Z,Fragment:q,useContext:B,createElement:W}=wp.element,{dispatch:V,select:H}=wp.data,K=e=>{const i=B(t),a=H("vibebp").getUser(),[n,s]=F(e.meeting);return Z((()=>{s(e.meeting)}),[e.meeting]),Z((()=>{document.dispatchEvent(new Event("VibeBP_Editor_Content"))}),[]),W(q,null,W("div",{className:"vibebp_full_meeting_wrapper"},W("div",{className:"vibebp_meetings_header"},W("span",{className:"vicon vicon-arrow-left",onClick:e.back}),W("span",null,W("span",{className:"meeting_date"},n.post_date),n.post_author===a.id?W("span",null,W("span",{className:"vicon vicon-pencil",onClick:()=>{i.update(n,"edit_meeting_id")}}),W("span",{className:"vicon vicon-trash",onClick:()=>{let t=`?post&args=${encodeURIComponent(JSON.stringify({id:n.id}))}`;fetch(`${window.vibezoom.api.url}/user/meetings/trash${t}`,{method:"post",body:JSON.stringify({token:H("vibebp").getToken(),meeting_id:n.id})}).then((e=>e.json())).then((t=>{t.hasOwnProperty("message")&&V("vibebp").addNotification({text:t.message}),t.status&&(e.update("remove",n),e.back())}))}})):"")),W("h3",{className:"post_title"},n.post_title),W("div",{className:"vibebp_meeting_content",dangerouslySetInnerHTML:{__html:n.post_content}}),n.meeting_details?W(J,{meeting:n}):"",n.post_author==a.id||n.meta.hasOwnProperty("show_recordings")&&n.meta.show_recordings?W(U,{id:n.id}):""))},{createElement:G,useState:Q,useEffect:X,Fragment:Y,render:ee}=wp.element,{dispatch:te,select:ie}=wp.data,ae=e=>{const[t,i]=Q({});return X((()=>{let t="",a="";switch(e.type){case"friends":a="user",t=e.id.item_id;break;case"forum":a="forum",t=e.id.item_id;break;case"group":a="group",t=e.id.item_id;break;case"activity":a="user",t=e.id.secondary_item_id;break;case"member":case"name":case"user_tip":case"user":a="user",t=e.id.user_id;break;default:a=e.type,t=e.id.item_id}a||(a="user");let n=ie("vibebp").getData(a+"_"+t);n?i(n):localforage.getItem(a+"_"+t).then((n=>{null!==n?(i(JSON.parse(n)),te("vibebp").setData(a+"_"+t,JSON.parse(n))):fetch(`${window.vibebp.api.url}/avatar?id=${a+"_"+t}&client_id=${window.vibebp.settings.client_id}`,{method:"post",body:JSON.stringify({type:e.type,ids:e.id,token:ie("vibebp").getToken()})}).then((e=>e.json())).then((e=>{e.hasOwnProperty("avatar")&&(te("vibebp").setData(a+"_"+t,e),localforage.setItem(a+"_"+t,JSON.stringify(e)),i(e))}))}))}),[e.id.item_id,e.id.user_id]),t.hasOwnProperty("avatar")||t.hasOwnProperty("name")?"member"==e.type?React.createElement("span",{className:"vibebp_member"},React.createElement("img",{src:t.avatar,className:"vibebp_avatar",onClick:e.click,alt:t.name,title:t.name}),React.createElement("span",null,t.name)):"group"==e.type?React.createElement("span",{className:"vibebp_group"},React.createElement("img",{src:t.avatar,className:"vibebp_avatar",onClick:e.click,alt:t.name,title:t.name}),React.createElement("span",null,t.name)):"user_tip"==e.type?React.createElement("span",{className:"vibebp_member tip",title:t.name},React.createElement("img",{src:t.avatar,className:"vibebp_avatar",onClick:e.click,alt:t.name,title:t.name})):"name"==e.type||"forum"==e.type?React.createElement("span",null,t.name):React.createElement("img",{src:t.avatar,className:"vibebp_avatar",onClick:e.click,alt:t.name,title:t.name}):""},ne=e=>{const[t,i]=Q(!0),[a,n]=Q(null);return X((()=>{i(!0);let t=[];a&&a.abort();let s={},o=new AbortController;a&&(s={signal:o.signal}),n(o),e.hasOwnProperty("avatars")&&(t=e.avatars);let r="user";if(e.hasOwnProperty("type")&&(r=e.type),e.hasOwnProperty("user_ids")){let i=e.user_ids;Array.isArray(e.user_ids)||(i=Object.values(e.user_ids)),i.map((e=>{Array.isArray(e)?e.map((e=>{-1==t.findIndex((t=>t.id.user_id==e))&&t.push({type:r,id:{user_id:e}})})):-1==t.findIndex((t=>t.id.user_id==e))&&t.push({type:r,id:{user_id:e}})}))}let l=[],d=[];t.map(((e,t)=>{let i="",a="";switch(e.type){case"friends":a="user",i=e.id.item_id;break;case"forum":a="forum",i=e.id.item_id;break;case"group":a="group",i=e.id.item_id;break;case"activity":a="user",i=e.id.secondary_item_id;break;case"member":case"name":case"user_tip":case"user":a="user",i=e.id.user_id;break;default:a=e.type,i=e.id.item_id}let n=ie("vibebp").getData(a+"_"+i);n&&void 0!==n||d.push(localforage.getItem(a+"_"+i).then((e=>{e?te("vibebp").setData(a+"_"+i,JSON.parse(e)):l.push({type:a,key:i})})))})),d.length?Promise.all(d).then((()=>{l.length?fetch(`${window.vibebp.api.url}/avatars?ids=${JSON.stringify(l)}&client_id=${window.vibebp.settings.client_id}`,{...s,method:"post",body:JSON.stringify({ids:l,type:r,token:ie("vibebp").getToken()})}).then((e=>e.json())).then((e=>{let t=[];e.status&&e.values.map((e=>{te("vibebp").setData(e.type+"_"+e.key,e.value),t.push(localforage.setItem(e.type+"_"+e.key,JSON.stringify(e.value)))})),t.length?Promise.all(t).then((()=>{i(!1)})):i(!1)})):i(!1)})):i(!1)}),[e.user_ids,e.type]),React.createElement(Y,null,t?"":e.children)},{useState:se,useEffect:oe,Fragment:re,render:le,useContext:de,createElement:me}=wp.element,{select:ce}=wp.data,pe=e=>{const i=de(t),[a,n]=se({scope:Object.keys(window.vibezoom.shared_tabs)[0],type:e.type,paged:1,s:"",orderby:"date",order:"DESC"}),[s,o]=se({...a}),[r,l]=se(!1),[d,m]=se(!1),[p,_]=se(i.meetings),[u,v]=se(!1),[b,g]=se(null);oe((()=>{_(i.meetings)}),[i.meetings]),oe((()=>{n({...a,type:e.type,s:"",paged:1})}),[e.type]);const h=()=>{n({...a,s:""})};oe((()=>(document.addEventListener("vibebp_component_reload",h),()=>{document.removeEventListener("vibebp_component_reload",h)}))),c((()=>{let e={...a},t=ce("vibebp").getId();t&&(e={...e,post__in:t}),b&&b.abort();let n=new AbortController,s=b?{signal:n.signal}:{};g(n),"mine"===e.type&&delete e.scope;let o=e.s.length?"?nocache":`?args=${encodeURIComponent(JSON.stringify({...e,s:""}))}`,r=1==e.paged?[]:[...p];w(r),l(!0),fetch(`${window.vibezoom.api.url}/user/meetings${o} `,{method:"post",...s,body:JSON.stringify({...e,token:ce("vibebp").getToken()})}).then((e=>e.json())).then((e=>{if(l(!1),e.status){r=1==a.paged?[]:[...p];let n=[...r,...e.meetings];if(m(n.length<parseInt(e.total)),w(n),t&&n.findIndex((e=>e.id==t))>-1){let e=n[n.findIndex((e=>e.id==t))];i.update(e,"show_meeting_id")}}})).catch((e=>{l(!1),"AbortError"===e.name||(g(null),console.error("Uh oh, an error!",e))}))}),500,[a]);const w=e=>{_(e),i.update(e,"set")};let y=[...p];return a.s.length&&(y=p.filter((e=>e.post_title.toLowerCase().indexOf(a.s.toLowerCase())>-1))),me("div",{className:"vibebp_meetings_wrapper"},me(re,null,me("div",{className:"vibebp_main_header vibebp_form"},me("div",{className:"vibebp_form_field"},me("input",{type:"text",value:a.s,onChange:e=>{n({...a,s:e.target.value,paged:1})},placeholder:window.vibezoom.translations.search_text})),"joined"==e.type?me("div",{class:"buttons has-addons"},Object.keys(window.vibezoom.shared_tabs).map((e=>me("button",{className:a.scope==e?"button is-success is-selected":"button",onClick:t=>{n({...a,s:"",scope:e,paged:1})}},window.vibezoom.shared_tabs[e])))):"",me("div",null,me("span",{className:"show_filters",onClick:()=>v(!u)},me("span",{className:u?"vicon vicon-close":"vicon vicon-menu-alt"},window.vibebp.translations.filter)),u?me(re,null,me("div",{className:"order_sorter"},me("select",{value:a.orderby,onChange:e=>{n({...a,s:"",orderby:e.target.value,paged:1})}},Object.keys(window.vibezoom.sorters).map((e=>me("option",{value:e},window.vibezoom.sorters[e])))),me("span",null,me("span",{className:"ASC"==a.order?"vicon vicon-angle-up active":"vicon vicon-angle-up",onClick:()=>{n({...a,s:"",order:"ASC"})}}),me("span",{className:"DESC"==a.order?"vicon vicon-angle-down active":"vicon vicon-angle-down",onClick:()=>{n({...a,s:"",order:"DESC"})}})))):"")),y&&y.length?me(re,null,me(ne,{type:"user",user_ids:y.map((e=>e.post_author))},me("div",{className:"vibebp_zoom_meetings"},y.map((e=>{let t=Date.now(),a=(e.meeting_details.start-t)/1e3,n="";return n=t>=e.meeting_details.start&&t<=e.meeting_details.end?"running":t<e.meeting_details.start?"upcoming_meeting":"meeting_over",me("div",{className:"vibebp_zoom_meeting",onClick:()=>{i.update(e,"show_meeting_id")}},me("div",null,me("span",{className:n},"running"==n?window.vibezoom.translations.meeting_running:"meeting_over"==n?window.vibezoom.translations.meeting_over:a>86400?Math.floor(a/86400)+window.vibezoom.translations.days:a>3600?Math.floor(a/3600)+window.vibezoom.translations.hours:a>60?Math.floor(a/60)+window.vibezoom.translations.minutes:Math.floor(a)+window.vibezoom.translations.seconds),me("h3",null,e.post_title),e.meeting_details?me("div",{className:"meeting_details"},e.meeting_details.start?me("span",null,me("span",null,me("span",{className:"vicon vicon-calendar"}),me("span",null,new Date(e.meeting_details.start).toLocaleString()))):"",e.meeting_details.end?me("span",null,me("span",null,me("span",{className:"vicon vicon-calendar"}),me("span",null,new Date(e.meeting_details.end).toLocaleString()))):""):""),me("div",{className:"vibebp_meeting_members"},me(ae,{type:"user",id:{user_id:e.post_author},not_show_name:!0})))})))),d?me("a",{className:"link",onClick:()=>{n({...a,paged:a.paged+1})}},window.vibezoom.translations.load_more):""):me("div",{className:"vbp_message"},window.vibezoom.translations.no_zooms),r?me("div",{class:"loading-roller"},me("div",null),me("div",null),me("div",null),me("div",null),me("div",null),me("div",null),me("div",null),me("div",null)):""))},{useState:_e,useEffect:ue,createElement:ve}=wp.element,{dispatch:be,select:ge}=wp.data,he=e=>{const[i,a]=_e({}),n=ge("vibebp").getUser(),[s,o]=_e([]),[r,l]=_e([]),[d,m]=_e(!1),[c,p]=_e(!0),[_,u]=_e([]),[v,b]=_e(!1),[g,h]=_e(!1),w=window.vibezoom.settings.editor_slug,y=n.caps.hasOwnProperty(window.vibezoom.settings.new_vibezoom_cap);return ue((()=>{let e=ge("vibebp").getMenu().filter((e=>"zoom_meeting"===e.parent)).filter((e=>!!y||-1==w.indexOf(e.slug)));e.map(((t,i)=>{-1===e.findIndex((e=>e.class.indexOf("current-menu-item")>-1))&&e[i].class.push("current-menu-item")})),-1==document.querySelector("body").classList.value.indexOf("withsidebar")&&document.querySelector("body").classList.add("withsidebar");let t=ge("vibebp").getAction();"view"==ge("vibebp").getAction()&&(t=Object.keys(window.vibezoom.shared_tabs)[0]),m(t),o(e)}),[]),ve("div",{className:"vibebp_sidebars"},ve("div",{className:"vibebp_left_sidebar_wrapper"},ve("div",{className:"vibebp_left_sidebar"},ve("h3",null,window.vibezoom.label),y?ve("a",{className:"button is-primary new_mail",onClick:()=>{b(!0)}},window.vibezoom.translations.create_zoom):"",s.map(((e,t)=>{let i=e.class.join(" ")+" "+e.css_id;return ve("a",{className:i,onClick:i=>{let a={...r};a.filter=e.css_id,a.page=1,r.css_id!==a.filter&&l(a),m(e.css_id);let n=[...s],d=n.findIndex((e=>e.class.indexOf("current-menu-item")>-1));n[d].class.splice(n[d].class.indexOf("current-menu-item"),1),n[t].class.push("current-menu-item"),o(n)}},e.name)})))),ve("div",{className:"vibebp_main"},ve("div",{className:"vibe_zoom_context_wrapper"},ve(t.Provider,{value:{meetings:_,update:(e,t,i={})=>{let a=[..._],n=-1;switch(t){case"add":a.push(e),u(a);break;case"update":n=a.findIndex((t=>t.id==e.id)),n>=0&&(a.splice(n,1,e),u(a));break;case"set":u(e);break;case"show_meeting_id":n=a.findIndex((t=>parseInt(t.id)==parseInt(e.id))),n>=0?(b(!1),h(a[n])):(b(!1),h(e));break;case"edit_meeting_id":n=a.findIndex((t=>parseInt(t.id)==parseInt(e.id))),n>=0&&(h(!1),b(a[n]))}}}},g?ve(K,{meeting:g,back:()=>{h(!1),be("vibebp").setId(!1)}}):v?ve(k,{meeting:v,back:()=>{b(!1)},created:e=>{b(!1)}}):ve(pe,"my_meetings"===d?{type:"joined"}:"manage_meetings"===d?{type:"mine"}:{type:"joined"})))))},{createElement:we,render:ye,useState:fe,useEffect:ke,Fragment:Ne,useContext:ze}=wp.element;document.addEventListener("component_loaded",(e=>{"zoom_meeting"===e.detail.component&&setTimeout((()=>{ye(we(he,{field:e.detail}),document.querySelector("#zoom_meeting_component"))}),200)}),!1),document.addEventListener("unit_loaded",(e=>{if(e.detail.hasOwnProperty("coursestatus")){if(document.querySelectorAll(".vibe_zoom_unit")){let e=document.querySelectorAll(".vibe_zoom_unit");for(var t=e.length-1;t>=0;t--)e[t].remove()}let i=e.detail.coursestatus;if(i.hasOwnProperty("courseitems")&&Array.isArray(i.courseitems)&&i.courseitems.length&&i.hasOwnProperty("current_unit_key")){let e=i.courseitems[i.current_unit_key];if(e.hasOwnProperty("id")&&"unit"==e.type&&e.hasOwnProperty("meta")&&e.meta.hasOwnProperty("unit_type")&&"wplms_zoom"==e.meta.unit_type&&e.meta.hasOwnProperty("zoom")&&e.meta.zoom){let t={...e.meta.zoom};setTimeout((()=>{let i=document.querySelector(".unit"+e.id);if(i){let t=document.createElement("div");t.setAttribute("id","unit_zoom_"+e.id),t.classList.add("vibe_zoom_unit"),i.appendChild(t)}let a=document.getElementById("unit_zoom_"+e.id);a&&ye(we(Ne,null,we(J,{meeting:t,show_timing:!0}),t.meta.hasOwnProperty("show_recordings")&&t.meta.show_recordings?we(U,{id:t.id}):""),a)}),200)}}}}),!1)})();